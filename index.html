<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Electric Music Generator</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      overflow: hidden;
      font-family: 'Segoe UI', sans-serif;
    }

    canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }

    #ui {
      position: absolute;
      z-index: 2;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 50, 0.8);
      padding: 30px;
      border-radius: 20px;
      color: white;
      text-align: center;
      box-shadow: 0 0 20px #00f7;
    }

    #ui h1 {
      margin: 0 0 20px;
      font-size: 2em;
      text-shadow: 0 0 5px #00f;
    }

    label, select, button {
      font-size: 1.2em;
      margin: 10px;
    }

    select, button {
      padding: 10px;
      border-radius: 10px;
      border: none;
      background: #0044ff;
      color: white;
      cursor: pointer;
      box-shadow: 0 0 10px #00f;
    }

    button:hover {
      background: #0022aa;
    }
  </style>
</head>
<body>

<canvas id="bg"></canvas>

<div id="ui">
  <h1>Electric Music Generator</h1>
  <label for="instrument">Instrument:</label>
  <select id="instrument">
    <option value="sine">Synth</option>
    <option value="triangle">Triangle</option>
    <option value="square">Square</option>
    <option value="sawtooth">Sawtooth</option>
    <option value="lowpass">Filtered - Lowpass</option>
    <option value="highpass">Filtered - Highpass</option>
  </select>
  <br>
  <button id="startBtn">Start Music</button>
</div>

<script>
  // Background Glow Animation
  const canvas = document.getElementById("bg");
  const ctx = canvas.getContext("2d");
  let w, h;
  function resize() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
  }
  window.addEventListener("resize", resize);
  resize();

  const sparks = Array.from({ length: 100 }, () => ({
    x: Math.random() * w,
    y: Math.random() * h,
    r: Math.random() * 2 + 1,
    dx: (Math.random() - 0.5) * 0.5,
    dy: (Math.random() - 0.5) * 0.5
  }));

  function draw() {
    ctx.fillStyle = "rgba(0, 0, 0, 0.15)";
    ctx.fillRect(0, 0, w, h);
    for (let p of sparks) {
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fillStyle = "rgba(0, 150, 255, 0.8)";
      ctx.fill();
      p.x += p.dx;
      p.y += p.dy;
      if (p.x < 0 || p.x > w) p.dx *= -1;
      if (p.y < 0 || p.y > h) p.dy *= -1;
    }
    requestAnimationFrame(draw);
  }
  draw();
</script>

<script>
  let audioCtx, gainNode, filterNode;
  let isPlaying = false;

  const instrumentSelector = document.getElementById("instrument");
  const startBtn = document.getElementById("startBtn");

  startBtn.onclick = async () => {
    if (!audioCtx) {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }

    if (isPlaying) return;

    isPlaying = true;
    gainNode = audioCtx.createGain();
    gainNode.gain.value = 0.1;
    gainNode.connect(audioCtx.destination);

    generateElectricMusic();
  };

  function generateElectricMusic() {
    let lastVal = Math.random();
    setInterval(() => {
      let signal = lastVal + (Math.random() - 0.5) * 0.05;
      signal = Math.max(0, Math.min(1, signal)); // Clamp
      lastVal = signal;

      let freq = 200 + signal * 600; // between 200Hz and 800Hz

      const osc = audioCtx.createOscillator();
      const selected = instrumentSelector.value;

      if (["sine", "triangle", "square", "sawtooth"].includes(selected)) {
        osc.type = selected;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        osc.connect(gainNode);
      } else {
        // Use default synth with filter
        osc.type = "sine";
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);

        filterNode = audioCtx.createBiquadFilter();
        filterNode.type = selected === "lowpass" ? "lowpass" : "highpass";
        filterNode.frequency.setValueAtTime(500, audioCtx.currentTime);
        osc.connect(filterNode);
        filterNode.connect(gainNode);
      }

      osc.start();
      osc.stop(audioCtx.currentTime + 0.3); // short tone
    }, 350);
  }
</script>

</body>
</html>
