<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Electric Music Generator</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: radial-gradient(ellipse at center, #020202 0%, #000000 100%);
      height: 100%;
      color: #aaddff;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    .container {
      background: rgba(0, 32, 64, 0.25);
      border: 2px solid #2bb3ff;
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 0 30px #0af;
    }

    h1 {
      font-size: 2em;
      margin-bottom: 20px;
    }

    select, button {
      font-size: 1.2em;
      margin: 10px;
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      background: #003f7f;
      color: #aaddff;
      box-shadow: 0 0 10px #00aaff;
      cursor: pointer;
    }

    button:hover, select:hover {
      background: #005fa3;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Electric Music Generator</h1>
    <select id="instrument">
      <option value="sine">Synth (Pure)</option>
      <option value="triangle">Triangle</option>
      <option value="square">Square</option>
      <option value="sawtooth">Sawtooth</option>
    </select>
    <br>
    <button onclick="startMusic()">Start</button>
    <button onclick="stopMusic()">Stop</button>
  </div>

  <script>
    let ctx = new (window.AudioContext || window.webkitAudioContext)();
    let playing = false;
    let nodes = [];
    let interval;

    function generateLayeredNote(freq, type) {
      const baseGain = ctx.createGain();
      baseGain.gain.value = 0.05;
      baseGain.connect(ctx.destination);

      const detuneRange = 0.5; // Slight natural detuning

      // Layered oscillators
      for (let i = 0; i < 3; i++) {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        const filter = ctx.createBiquadFilter();

        osc.type = type;
        osc.frequency.value = freq + (Math.random() - 0.5) * detuneRange;

        gain.gain.setValueAtTime(0, ctx.currentTime);
        gain.gain.linearRampToValueAtTime(0.03, ctx.currentTime + 0.1);
        gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 5);

        filter.type = "lowpass";
        filter.frequency.value = 1200;

        osc.connect(filter);
        filter.connect(gain);
        gain.connect(baseGain);

        osc.start();
        osc.stop(ctx.currentTime + 6);
        nodes.push(osc);
      }

      // Add filtered soft white noise
      const bufferSize = 2 * ctx.sampleRate;
      const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
      const output = noiseBuffer.getChannelData(0);
      for (let i = 0; i < bufferSize; i++) {
        output[i] = (Math.random() * 2 - 1) * 0.25;
      }

      const noise = ctx.createBufferSource();
      noise.buffer = noiseBuffer;
      noise.loop = false;

      const noiseFilter = ctx.createBiquadFilter();
      noiseFilter.type = 'lowpass';
      noiseFilter.frequency.value = 600;

      const noiseGain = ctx.createGain();
      noiseGain.gain.setValueAtTime(0.01, ctx.currentTime);
      noiseGain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 4);

      noise.connect(noiseFilter);
      noiseFilter.connect(noiseGain);
      noiseGain.connect(ctx.destination);

      noise.start();
      noise.stop(ctx.currentTime + 4);
    }

    function startMusic() {
      if (playing) return;
      playing = true;

      const type = document.getElementById('instrument').value;

      interval = setInterval(() => {
        let baseFreq = 100; // Lower base frequency
        let freq = baseFreq + Math.pow(Math.random(), 2.2) * 600;
        generateLayeredNote(freq, type);
      }, 700 + Math.random() * 200);
    }

    function stopMusic() {
      playing = false;
      clearInterval(interval);
      nodes.forEach(n => n.stop());
      nodes = [];
    }
  </script>
</body>
</html>
