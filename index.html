<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Electric Music Generator</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      overflow: hidden;
      font-family: 'Segoe UI', sans-serif;
    }

    canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }

    #ui {
      position: absolute;
      z-index: 2;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 50, 0.8);
      padding: 30px;
      border-radius: 20px;
      color: white;
      text-align: center;
      box-shadow: 0 0 20px #00f7;
    }

    #ui h1 {
      margin: 0 0 20px;
      font-size: 2em;
      text-shadow: 0 0 5px #00f;
    }

    label, select, button {
      font-size: 1.2em;
      margin: 10px;
    }

    select, button {
      padding: 10px;
      border-radius: 10px;
      border: none;
      background: #0044ff;
      color: white;
      cursor: pointer;
      box-shadow: 0 0 10px #00f;
    }

    button:hover {
      background: #0022aa;
    }
  </style>
</head>
<body>

<canvas id="bg"></canvas>

<div id="ui">
  <h1>Electric Music Generator</h1>
  <label for="instrument">Instrument:</label>
  <select id="instrument">
    <option value="sine">Synth</option>
    <option value="triangle">Triangle</option>
    <option value="square">Square</option>
    <option value="sawtooth">Sawtooth</option>
    <option value="lowpass">Filtered - Lowpass</option>
    <option value="highpass">Filtered - Highpass</option>
  </select>
  <br>
  <button id="startBtn">Start Music</button>
  <button id="stopBtn">Stop Music</button>
</div>

<script>
  // Background glow
  const canvas = document.getElementById("bg");
  const ctx = canvas.getContext("2d");
  let w, h;
  function resize() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
  }
  window.addEventListener("resize", resize);
  resize();

  const sparks = Array.from({ length: 100 }, () => ({
    x: Math.random() * w,
    y: Math.random() * h,
    r: Math.random() * 2 + 1,
    dx: (Math.random() - 0.5) * 0.5,
    dy: (Math.random() - 0.5) * 0.5
  }));

  function draw() {
    ctx.fillStyle = "rgba(0, 0, 0, 0.1)";
    ctx.fillRect(0, 0, w, h);
    for (let p of sparks) {
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fillStyle = "rgba(0, 150, 255, 0.8)";
      ctx.fill();
      p.x += p.dx;
      p.y += p.dy;
      if (p.x < 0 || p.x > w) p.dx *= -1;
      if (p.y < 0 || p.y > h) p.dy *= -1;
    }
    requestAnimationFrame(draw);
  }
  draw();
</script>

<script>
  let audioCtx;
  let gainNode;
  let intervalId;
  let isPlaying = false;
  const oscillators = [];

  const instrumentSelector = document.getElementById("instrument");
  const startBtn = document.getElementById("startBtn");
  const stopBtn = document.getElementById("stopBtn");

  startBtn.addEventListener("click", () => {
    if (isPlaying) return;

    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    gainNode = audioCtx.createGain();
    gainNode.gain.value = 0.1;
    gainNode.connect(audioCtx.destination);

    isPlaying = true;
    startElectricWaves();
  });

  stopBtn.addEventListener("click", () => {
    if (!isPlaying) return;

    clearInterval(intervalId);
    oscillators.forEach(o => {
      try {
        o.gain.gain.setTargetAtTime(0, audioCtx.currentTime, 0.5);
        o.osc.stop(audioCtx.currentTime + 1);
      } catch (e) {}
    });
    oscillators.length = 0;
    isPlaying = false;
  });

  function startElectricWaves() {
    let lastVal = Math.random();

    intervalId = setInterval(() => {
      const signal = Math.max(0, Math.min(1, lastVal + (Math.random() - 0.5) * 0.05));
      lastVal = signal;
      const freq = 120 + signal * 600;

      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      const instrument = instrumentSelector.value;

      if (["sine", "square", "triangle", "sawtooth"].includes(instrument)) {
        osc.type = instrument;
      } else {
        const filter = audioCtx.createBiquadFilter();
        filter.type = instrument;
        filter.frequency.setValueAtTime(500, audioCtx.currentTime);
        osc.type = "sine";
        osc.connect(filter);
        filter.connect(gain);
      }

      osc.frequency.setValueAtTime(freq, audioCtx.currentTime);

      gain.gain.setValueAtTime(0, audioCtx.currentTime);
      gain.gain.linearRampToValueAtTime(0.08, audioCtx.currentTime + 1);
      gain.gain.setTargetAtTime(0, audioCtx.currentTime + 4, 1);

      osc.connect(gain);
      gain.connect(gainNode);

      osc.start();
      osc.stop(audioCtx.currentTime + 6);

      oscillators.push({ osc, gain });

      // Trim old oscillators
      if (oscillators.length > 20) oscillators.splice(0, 5);
    }, 1000);
  }
</script>

</body>
</html>
