<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PlantWave-style Generator</title>
<style>
  body {
    margin: 0;
    background: linear-gradient(135deg, #002244, #005577);
    color: #bbdefb;
    font-family: sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }
  #app {
    background: rgba(0, 51, 102, 0.9);
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 0 20px #3399ff88;
    text-align: center;
    max-width: 400px;
    width: 90%;
  }
  select, button {
    margin-top: 10px;
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 8px;
    background: #005f99;
    color: white;
    font-size: 1em;
  }
</style>
</head>
<body>
<div id="app">
  <h1>PlantWave Music</h1>
  <select id="instrument">
    <option value="synth">Synth (Raw)</option>
    <option value="flute">Flute</option>
    <option value="piano">Piano</option>
    <option value="pad">Pad</option>
    <option value="bell">Bell</option>
  </select>
  <button id="startStopBtn">Start Music</button>
</div>

<script>
let audioCtx = null;
let osc1, osc2, osc3, gainNode, noiseNode, noiseGain, filterNode;
let isPlaying = false;

const instrumentSelect = document.getElementById('instrument');
const startStopBtn = document.getElementById('startStopBtn');

function createLFO(freq, depth) {
  const lfo = audioCtx.createOscillator();
  const lfoGain = audioCtx.createGain();
  lfo.type = 'sine';
  lfo.frequency.value = freq;
  lfoGain.gain.value = depth;
  lfo.connect(lfoGain);
  lfo.start();
  return lfoGain;
}

function createNoise() {
  const bufferSize = audioCtx.sampleRate * 2;
  const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
  const data = buffer.getChannelData(0);
  for (let i = 0; i < bufferSize; i++) {
    data[i] = (Math.random() * 2 - 1) * 0.1; // increased from 0.03
  }
  const noise = audioCtx.createBufferSource();
  noise.buffer = buffer;
  noise.loop = true;
  return noise;
}

function applyFilter(type) {
  if (filterNode) filterNode.disconnect();
  filterNode = audioCtx.createBiquadFilter();
  switch(type) {
    case 'flute': filterNode.type = 'bandpass'; filterNode.frequency.value = 1100; filterNode.Q.value = 10; break;
    case 'piano': filterNode.type = 'lowpass'; filterNode.frequency.value = 1400; filterNode.Q.value = 6; break;
    case 'pad':   filterNode.type = 'lowpass'; filterNode.frequency.value = 800; filterNode.Q.value = 1.2; break;
    case 'bell':  filterNode.type = 'peaking'; filterNode.frequency.value = 2500; filterNode.Q.value = 15; filterNode.gain.value = 8; break;
    case 'synth':
    default: return null;
  }
  return filterNode;
}

startStopBtn.addEventListener('click', () => {
  if (!isPlaying) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    osc1 = audioCtx.createOscillator();
    osc2 = audioCtx.createOscillator();
    osc3 = audioCtx.createOscillator();

    osc1.type = osc2.type = osc3.type = 'triangle';
    osc1.frequency.value = 220;
    osc2.frequency.value = 220 * 1.005;
    osc3.frequency.value = 220 * 0.997;

    gainNode = audioCtx.createGain();
    gainNode.gain.value = 0.4; // louder

    const ampLFO = createLFO(0.03, 0.2);
    ampLFO.connect(gainNode.gain);

    const freqLFO1 = createLFO(0.05, 3);
    const freqLFO2 = createLFO(0.07, 2);
    freqLFO1.connect(osc1.frequency);
    freqLFO2.connect(osc2.frequency);

    noiseNode = createNoise();
    noiseGain = audioCtx.createGain();
    noiseGain.gain.value = 0.05;

    const filter = applyFilter(instrumentSelect.value);

    osc1.connect(gainNode);
    osc2.connect(gainNode);
    osc3.connect(gainNode);
    noiseNode.connect(noiseGain);

    if (filter) {
      gainNode.connect(filter);
      noiseGain.connect(filter);
      filter.connect(audioCtx.destination);
    } else {
      gainNode.connect(audioCtx.destination);
      noiseGain.connect(audioCtx.destination);
    }

    noiseNode.start();
    osc1.start(); osc2.start(); osc3.start();

    isPlaying = true;
    startStopBtn.textContent = "Stop Music";
  } else {
    osc1.stop(); osc2.stop(); osc3.stop(); noiseNode.stop();
    osc1.disconnect(); osc2.disconnect(); osc3.disconnect();
    gainNode.disconnect(); noiseGain.disconnect();
    if (filterNode) filterNode.disconnect();
    audioCtx.close();

    isPlaying = false;
    startStopBtn.textContent = "Start Music";
  }
});

instrumentSelect.addEventListener('change', () => {
  if (isPlaying) {
    startStopBtn.click(); // stop
    setTimeout(() => startStopBtn.click(), 100); // restart
  }
});
</script>
</body>
</html>
