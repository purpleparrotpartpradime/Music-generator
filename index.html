<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calm Electro Music Generator â€” PlantWave Style</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(135deg, #003366, #006699);
    color: #bbdefb;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  #app {
    position: relative;
    z-index: 2;
    max-width: 400px;
    width: 90vw;
    background: rgba(0, 51, 102, 0.85);
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 0 30px #3399ffaa;
    text-align: center;
  }
  h1 {
    margin-bottom: 10px;
    font-weight: 700;
    color: #99ccff;
  }
  label {
    display: block;
    margin: 15px 0 5px;
    font-weight: 600;
  }
  select, button {
    width: 100%;
    padding: 12px;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
    background: #005f99;
    color: #d0eaff;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  select:hover, button:hover {
    background: #3388cc;
  }
  #loading {
    margin-top: 10px;
    font-size: 0.9rem;
    color: #bbdefb;
    min-height: 1.4em;
  }
</style>
</head>
<body>
<div id="app">
  <h1>Calm Electro Music Generator</h1>
  <label for="instrument">Select Instrument:</label>
  <select id="instrument">
    <option value="synth">Synth (Raw Wave)</option>
    <option value="flute">Soft Flute</option>
    <option value="piano">Warm Piano</option>
    <option value="pad">Dreamy Pad</option>
    <option value="bell">Gentle Bell</option>
  </select>

  <button id="startStopBtn">Start Music</button>
  <div id="loading"></div>
</div>

<script>
(() => {
  const AudioContext = window.AudioContext || window.webkitAudioContext;
  let audioCtx = null;
  let osc1 = null, osc2 = null, osc3 = null;
  let gainNode = null;
  let filterNode = null;
  let noiseNode = null;
  let noiseGain = null;
  let isPlaying = false;

  const instrumentSelect = document.getElementById('instrument');
  const startStopBtn = document.getElementById('startStopBtn');

  // Create LFO helper for smooth slow modulation
  function createLFO(freq, depth, type = 'sine') {
    const osc = audioCtx.createOscillator();
    osc.type = type;
    osc.frequency.value = freq;

    const gain = audioCtx.createGain();
    gain.gain.value = depth;

    osc.connect(gain);
    osc.start();

    return gain;
  }

  // Create subtle white noise source
  function createNoiseBuffer() {
    const bufferSize = audioCtx.sampleRate * 2; // 2 seconds buffer
    const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) {
      data[i] = (Math.random() * 2 - 1) * 0.03; // very low amplitude noise
    }
    return buffer;
  }

  // Apply instrument filter with gentle tweaks
  function applyInstrumentFilter(type) {
    if (filterNode) filterNode.disconnect();

    filterNode = audioCtx.createBiquadFilter();

    switch(type) {
      case 'flute':
        filterNode.type = 'bandpass';
        filterNode.frequency.value = 1100;
        filterNode.Q.value = 10;
        break;
      case 'piano':
        filterNode.type = 'lowpass';
        filterNode.frequency.value = 1400;
        filterNode.Q.value = 6;
        break;
      case 'pad':
        filterNode.type = 'lowpass';
        filterNode.frequency.value = 800;
        filterNode.Q.value = 1.2;
        break;
      case 'bell':
        filterNode.type = 'peaking';
        filterNode.frequency.value = 2500;
        filterNode.Q.value = 15;
        filterNode.gain.value = 8;
        break;
      case 'synth':
      default:
        filterNode.disconnect();
        filterNode = null;
        break;
    }
    return filterNode;
  }

  function startAudio() {
    if (isPlaying) return;
    audioCtx = new AudioContext();

    // Three oscillators detuned slightly for soft beating
    osc1 = audioCtx.createOscillator();
    osc2 = audioCtx.createOscillator();
    osc3 = audioCtx.createOscillator();

    osc1.type = 'triangle';
    osc2.type = 'triangle';
    osc3.type = 'triangle';

    const baseFreq = 220; // A3
    osc1.frequency.value = baseFreq;
    osc2.frequency.value = baseFreq * 1.005; // slight detune +0.5%
    osc3.frequency.value = baseFreq * 0.997; // slight detune -0.3%

    // Gain node controls overall volume and modulation
    gainNode = audioCtx.createGain();
    gainNode.gain.value = 0.25;

    // Create slow LFOs for subtle freq modulation (0.05Hz) and amplitude (0.03Hz)
    // LFO amplitude smaller for smooth organic feel
    const freqLFO1 = createLFO(0.05, 4);
    const freqLFO2 = createLFO(0.043, 3);
    const ampLFO = createLFO(0.03, 0.12);

    freqLFO1.connect(osc1.frequency);
    freqLFO2.connect(osc2.frequency);
    ampLFO.connect(gainNode.gain);

    // Noise source mixed softly for organic texture
    const noiseBuffer = createNoiseBuffer();
    noiseNode = audioCtx.createBufferSource();
    noiseNode.buffer = noiseBuffer;
    noiseNode.loop = true;

    noiseGain = audioCtx.createGain();
    noiseGain.gain.value = 0.05;

    noiseNode.connect(noiseGain);

    // Filter according to instrument choice
    const inst = instrumentSelect.value;
    const filter = applyInstrumentFilter(inst);

    // Connect oscillators together to gain
    osc1.connect(gainNode);
    osc2.connect(gainNode);
    osc3.connect(gainNode);

    // Mix noise after gain node to filter and destination
    if (filter) {
      gainNode.connect(filter);
      noiseGain.connect(filter);
      filter.connect(audioCtx.destination);
    } else {
      gainNode.connect(audioCtx.destination);
      noiseGain.connect(audioCtx.destination);
    }

    noiseNode.start();

    osc1.start();
    osc2.start();
    osc3.start();

    isPlaying = true;
    startStopBtn.textContent = 'Stop Music';
  }

  function stopAudio() {
    if (!isPlaying) return;

    osc1.stop();
    osc2.stop();
    osc3.stop();
    noiseNode.stop();

    osc1.disconnect();
    osc2.disconnect();
    osc3.disconnect();
    noiseNode.disconnect();
    noiseGain.disconnect();
    gainNode.disconnect();
    if (filterNode) filterNode.disconnect();

    audioCtx.close();

    audioCtx = null;
    osc1 = null; osc2 = null; osc3 = null;
    noiseNode = null; noiseGain = null;
    gainNode = null;
    filterNode = null;
    isPlaying = false;
    startStopBtn.textContent = 'Start Music';
  }

  startStopBtn.addEventListener('click', () => {
    if (!isPlaying) {
      startAudio();
    } else {
      stopAudio();
    }
  });

  instrumentSelect.addEventListener('change', () => {
    if (isPlaying) {
      stopAudio();
      startAudio();
    }
  });
})();
</script>
</body>
</html>
