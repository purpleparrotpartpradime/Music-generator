<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calm Electro Music Generator</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(135deg, #003366, #006699);
    color: #bbdefb;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  #app {
    position: relative;
    z-index: 2;
    max-width: 400px;
    width: 90vw;
    background: rgba(0, 51, 102, 0.8);
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 0 25px #3399ffaa;
    text-align: center;
  }
  h1 {
    margin-bottom: 10px;
    font-weight: 700;
    color: #99ccff;
  }
  label {
    display: block;
    margin: 15px 0 5px;
    font-weight: 600;
  }
  select, button {
    width: 100%;
    padding: 12px;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
    background: #005f99;
    color: #d0eaff;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  select:hover, button:hover {
    background: #3388cc;
  }
  #loading {
    margin-top: 10px;
    font-size: 0.9rem;
    color: #bbdefb;
    min-height: 1.4em;
  }
</style>
</head>
<body>
<div id="app">
  <h1>Calm Electro Music Generator</h1>
  <label for="instrument">Select Instrument:</label>
  <select id="instrument">
    <option value="synth">Synth (Raw Wave)</option>
    <option value="flute">Soft Flute</option>
    <option value="piano">Warm Piano</option>
    <option value="pad">Dreamy Pad</option>
    <option value="bell">Gentle Bell</option>
  </select>

  <button id="startStopBtn">Start Music</button>
  <div id="loading"></div>
</div>

<script>
(() => {
  // --- Web Audio Setup ---

  const AudioContext = window.AudioContext || window.webkitAudioContext;
  let audioCtx = null;
  let oscillator = null;
  let gainNode = null;
  let filterNode = null;
  let isPlaying = false;

  const instrumentSelect = document.getElementById('instrument');
  const startStopBtn = document.getElementById('startStopBtn');

  // Simulate electrical changes: slow random modulation of frequency and amplitude
  // Use smooth LFOs to gently modulate freq and volume

  function createLFO(freq, depth, type = 'sine') {
    const osc = audioCtx.createOscillator();
    osc.type = type;
    osc.frequency.value = freq;

    const gain = audioCtx.createGain();
    gain.gain.value = depth;

    osc.connect(gain);
    osc.start();

    return gain;
  }

  function applyInstrumentFilter(type) {
    if (filterNode) filterNode.disconnect();

    filterNode = audioCtx.createBiquadFilter();

    switch(type) {
      case 'flute':
        filterNode.type = 'bandpass';
        filterNode.frequency.value = 1000;
        filterNode.Q.value = 8;
        break;
      case 'piano':
        filterNode.type = 'lowpass';
        filterNode.frequency.value = 1500;
        filterNode.Q.value = 5;
        break;
      case 'pad':
        filterNode.type = 'lowpass';
        filterNode.frequency.value = 900;
        filterNode.Q.value = 1;
        break;
      case 'bell':
        filterNode.type = 'peaking';
        filterNode.frequency.value = 2500;
        filterNode.Q.value = 15;
        filterNode.gain.value = 8;
        break;
      case 'synth':
      default:
        filterNode.disconnect();
        filterNode = null;
        break;
    }
    return filterNode;
  }

  function startAudio() {
    if (isPlaying) return;
    audioCtx = new AudioContext();

    oscillator = audioCtx.createOscillator();
    oscillator.type = 'triangle';
    oscillator.frequency.value = 220;

    gainNode = audioCtx.createGain();
    gainNode.gain.value = 0.3;

    const freqMod = createLFO(0.1, 15);
    freqMod.connect(oscillator.frequency);

    const ampMod = createLFO(0.07, 0.15);
    ampMod.connect(gainNode.gain);

    const inst = instrumentSelect.value;
    const filter = applyInstrumentFilter(inst);

    if (filter) {
      oscillator.connect(filter);
      filter.connect(gainNode);
    } else {
      oscillator.connect(gainNode);
    }

    gainNode.connect(audioCtx.destination);

    oscillator.start();

    isPlaying = true;
    startStopBtn.textContent = 'Stop Music';
  }

  function stopAudio() {
    if (!isPlaying) return;
    oscillator.stop();
    oscillator.disconnect();
    gainNode.disconnect();
    if (filterNode) filterNode.disconnect();
    audioCtx.close();

    audioCtx = null;
    oscillator = null;
    gainNode = null;
    filterNode = null;
    isPlaying = false;
    startStopBtn.textContent = 'Start Music';
  }

  startStopBtn.addEventListener('click', () => {
    if (!isPlaying) {
      startAudio();
    } else {
      stopAudio();
    }
  });

  instrumentSelect.addEventListener('change', () => {
    if (isPlaying) {
      stopAudio();
      startAudio();
    }
  });
})();
</script>
</body>
</html>
